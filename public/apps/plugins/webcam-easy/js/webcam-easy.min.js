class Webcam{constructor(e,t=null,i=null,s=0){this._webcamElement=e,this._webcamElement.width=this._webcamElement.width||640,this._webcamElement.height=this._webcamElement.height||.75*video.width,this._webcamList=[],this._streamList=[],this._selectedDeviceId="",this._activeCamIdx=s,this._canvasElement=t,this._snapSoundElement=i}get webcamList(){return this._webcamList}get webcamCount(){return this._webcamList.length}get selectedDeviceId(){return this._selectedDeviceId}get getActiveCam(){return this._activeCamIdx}set setActiveCam(e){this._activeCamIdx=e}getVideoInputs(e){return this._webcamList=[],e.forEach(e=>{"videoinput"===e.kind&&this._webcamList.push(e)}),1==this._webcamList.length&&(this._activeCamIdx=0),this._selectedDeviceId=this._webcamList[this._activeCamIdx].deviceId,this._webcamList}getMediaConstraints(){var e={};return e.deviceId={exact:this._selectedDeviceId},{video:e,audio:!1}}selectCamera(){this._webcamList.length>1&&(""==this._selectedDeviceId?(this._selectedDeviceId=this._webcamList[0].deviceId,this._activeCamIdx=0):(this._activeCamIdx=this._activeCamIdx+1,this._activeCamIdx>this.webcamList.length-1&&(this._activeCamIdx=0),this._selectedDeviceId=this._webcamList[this._activeCamIdx].deviceId))}flip(){this._webcamElement.style.transform="",this.selectCamera()}async start(e=!0){return new Promise((e,t)=>{this.stop(),navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(i=>{this._streamList.push(i),this.info().then(t=>{this.stream(),e(this._selectedDeviceId)}).catch(e=>{t(e)})}).catch(e=>{t(e)})})}async info(){return new Promise((e,t)=>{navigator.mediaDevices.enumerateDevices().then(t=>{this.getVideoInputs(t),e(this._webcamList)}).catch(e=>{t(e)})})}async stream(){return new Promise((e,t)=>{navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(t=>{this._streamList.push(t),this._webcamElement.srcObject=t,this._webcamElement.play(),e(this._selectedDeviceId)}).catch(e=>{t(e)})})}stop(){this._streamList.forEach(e=>{e.getTracks().forEach(e=>{e.stop()})})}snap(){if(null!=this._canvasElement){null!=this._snapSoundElement&&this._snapSoundElement.play(),this._canvasElement.height=this._webcamElement.scrollHeight,this._canvasElement.width=this._webcamElement.scrollWidth;let e=this._canvasElement.getContext("2d");return e.clearRect(0,0,this._canvasElement.width,this._canvasElement.height),e.drawImage(this._webcamElement,0,0,this._canvasElement.width,this._canvasElement.height),this._canvasElement.toDataURL("image/png")}throw"canvas element is missing"}}